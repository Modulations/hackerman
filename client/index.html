<link rel="stylesheet" href="./hackerman.css">
<script>
    const ws = new WebSocket('ws://localhost:2332');

    // When the ws is open, send some data to the server
    ws.onopen = function () {
        ws.send({"type":"ping"}); // Send the message 'Ping' to the server
    };

    // Log errors
    ws.onerror = function (error) {
        console.log('WebSocket Error ' + error);
    };

    // Log messages from the server
    ws.onmessage = function (e) {
        console.log('Server: ' + e.data);
    };
</script>

<span>Test words!</span>
<table></table>
<input id="eventType" type="text" placeholder="event type" value="login"/>
<input id="userDataInput" type="text" placeholder="data" class="search" onkeydown="search(this)" value='{"username":"risk", "password":"a"}'/>

<script>
    var msgEvent = document.getElementById("eventType");
    var input = document.getElementById("userDataInput");
    var eventType = "invalid";
    function search(ele) {
        if(event.key === 'Enter') {
            if (msgEvent.value != null) { eventType = msgEvent.value; } else { eventType = "invalid"; }

            var dataVal = ele.value;
            if (IsJsonString(ele.value)) {
                dataVal = JSON.parse(ele.value);
            }
            var msg = buildMsg(dataVal, eventType);
            console.log(msg);

            ws.send(JSON.stringify(msg));
            
            console.log("Sent: " + JSON.stringify(msg));
            ele.value = "";
        }
    }
    function buildMsg(data = {"data":false}, type = "invalid") {
        var assembly = {"event":type, "data":data};
        return assembly;
    }
    function buildEvent(eventType, data={}) {
        return JSON.stringify({"event":eventType, "data":data})
    }
    function IsJsonString(str) {
        try {
            JSON.parse(str);
        } catch (e) {
            return false;
        }
        return true;
    }
</script>